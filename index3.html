<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Évolution de la maternité en France</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
        @page {
            size: A4 portrait;
            margin: 0;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
        }
        
        .container {
            width: 210mm;
            height: 297mm;
            margin: 0 auto;
            padding: 8mm;
            box-sizing: border-box;
            background: white;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3mm;
            background: #4361ee; /* Nouvelle couleur solide */
            padding: 4mm;
            border-radius: 3mm;
            color: white;
        }
        
        .title {
            font-size: 20pt;
            font-weight: bold;
            margin: 0 0 2mm 0;
            line-height: 1.1;
        }
        
        .subtitle {
            font-size: 10pt;
            margin: 0;
            font-weight: 300;
            opacity: 0.95;
        }
        
        .data-info-box {
            background: #f0f7ff;
            padding: 2mm;
            border-radius: 2mm;
            margin-bottom: 3mm;
            border-left: 2mm solid #4361ee;
            font-size: 8pt;
            color: #2c3e50;
        }
        
        .data-info-title {
            font-weight: bold;
            margin-bottom: 1mm;
            color: #4361ee;
        }
        
        .intro-box {
            background: #f8f9fa;
            padding: 3mm;
            border-radius: 2mm;
            margin-bottom: 3mm;
            border-left: 3mm solid #4361ee;
        }
        
        .intro-text {
            font-size: 9pt;
            line-height: 1.4;
            color: #2c3e50;
            margin: 0;
        }
        
        .main-chart-section {
            margin-bottom: 2mm;
        }
        
        .chart-container {
            background: white;
            margin-bottom: 2mm;
        }
        
        .full-width-chart {
            margin-bottom: 3mm;
        }
        
        .chart-title {
            font-size: 10pt;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 2mm;
            text-align: center;
        }
        
        .mini-stats-container {
            display: flex;
            gap: 3mm;
            justify-content: center;
            margin-top: 2mm;
            margin-bottom: 3mm;
        }
        
        .mini-stat {
            flex: 1;
            background: #f8f9fa;
            padding: 2.5mm;
            border-radius: 2mm;
            text-align: center;
        }
        
        .mini-stat-number {
            font-size: 16pt;
            font-weight: bold;
            margin: 0;
            line-height: 1;
        }
        
        .mini-stat-text {
            font-size: 7.5pt;
            color: #2c3e50;
            margin: 1mm 0 0 0;
            line-height: 1.3;
        }
        
        .red { color: #e74c3c; border-left: 2mm solid #e74c3c; }
        .blue { color: #3498db; border-left: 2mm solid #3498db; }
        .green { color: #27ae60; border-left: 2mm solid #27ae60; }
        
        .two-column {
            display: flex;
            gap: 4mm;
            margin-bottom: 3mm;
        }
        
        .column {
            flex: 1;
        }
        
        .stat-box {
            background: #4361ee;
            color: white;
            padding: 3mm;
            border-radius: 2mm;
            text-align: center;
            margin-bottom: 3mm;
        }
        
        .stat-number {
            font-size: 22pt;
            font-weight: bold;
            margin: 0;
            line-height: 1;
        }
        
        .stat-label {
            font-size: 7.5pt;
            margin: 1mm 0 0 0;
            opacity: 0.9;
        }
        
        .insight-box {
            background: #fff9e6;
            padding: 2.5mm;
            border-radius: 2mm;
            margin-top: 2mm;
            margin-bottom: 3mm;
            border-left: 2mm solid #f39c12;
        }
        
        .insight-text {
            font-size: 8pt;
            line-height: 1.3;
            color: #34495e;
            margin: 0;
        }
        
        .conclusion-box {
            background: #e8f5e9;
            padding: 3mm;
            border-radius: 2mm;
            border-left: 3mm solid #27ae60;
            margin-top: 3mm;
        }
        
        .conclusion-title {
            font-size: 9.5pt;
            font-weight: bold;
            color: #27ae60;
            margin: 0 0 1.5mm 0;
        }
        
        .conclusion-text {
            font-size: 8pt;
            line-height: 1.4;
            color: #2c3e50;
            margin: 0;
        }
        
        .axis-label {
            font-size: 8pt;
            fill: #7f8c8d;
        }
        
        @media print {
            body { margin: 0; padding: 0; }
            .container { page-break-after: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- En-tête -->
        <div class="header">
            <h1 class="title">La maternité française se transforme</h1>
            <p class="subtitle">Évolution de la fécondité par âge (1901-2025)</p>
        </div>
        
        <!-- Informations sur les données -->
         <div class="data-info-box">
            <div class="data-info-title">Jeu de données DS_FECONDITE</div>
            <span>Période de référence : 1901 - 2025</span> &nbsp;|&nbsp;
            <span>Nombre de lignes : 30 193</span> &nbsp;|&nbsp;
            <span>Source : INSEE - Données annuelles de fécondité par âge</span>
        </div>
        <!-- <div class="data-info-box">
            <div class="data-info-title">Jeu de données DS_FECONDITE</div>
            <div>Période de référence : 1901 - 2025</div>
            <div>Nombre de lignes : 30 193</div>
            <div>Source : INSEE - Données annuelles de fécondité par âge</div>
        </div> -->
        
        <!-- Introduction -->
        <div class="intro-box">
            <p class="intro-text">
                En France, les femmes ont moins d'enfants et les ont de plus en plus tard. Cette transformation démographique s'étendant sur plus d'un siècle reflète l'évolution profonde des sociétés occidentales : allongement des études, insertion professionnelle, évolution des choix de vie et transformations sociales.
            </p>
        </div>
        
        <!-- Graphique principal avec boîtes mini-stat en dessous -->
        <div class="main-chart-section">
            <div class="chart-container">
                <div class="chart-title">Évolution du taux de fécondité selon l'âge (1901-2025)</div>
                <svg id="mainChart"></svg>
            </div>
            
            <!-- Boîtes mini-stat sur la même ligne, en dessous du graphique -->
            <div class="mini-stats-container">
                <div class="mini-stat red">
                    <p class="mini-stat-number">-57%</p>
                    <p class="mini-stat-text">Baisse de la fécondité<br>chez les 15-24 ans<br>(1901-2025)</p>
                </div>
                
                <div class="mini-stat blue">
                    <p class="mini-stat-number">+7%</p>
                    <p class="mini-stat-text">Augmentation de la fécondité<br>chez les 25-34 ans<br>(1901-2025)</p>
                </div>
                
                <div class="mini-stat green">
                    <p class="mini-stat-number">+52%</p>
                    <p class="mini-stat-text">Augmentation de la fécondité<br>chez les 35-44 ans<br>(1901-2025)</p>
                </div>
            </div>
        </div>
        
        <!-- Encadré insight -->
        <div class="insight-box">
            <p class="insight-text">
                <strong>Le grand basculement séculaire :</strong> Sur plus d'un siècle, on observe une inversion complète des modèles de fécondité. Alors qu'au début du XXe siècle les naissances étaient concentrées chez les jeunes femmes, aujourd'hui ce sont les femmes de 25-34 ans qui portent la natalité française, concentrant près de 70% des naissances.
            </p>
        </div>
        
        <!-- Deuxième rangée : Comparaison et évolution de l'âge moyen -->
        <div class="two-column">
            <div class="column">
                <div class="chart-container">
                    <div class="chart-title">Comparaison 1901 vs 2025</div>
                    <svg id="comparisonChart"></svg>
                </div>
            </div>
            
            <div class="column">
                <div class="chart-container">
                    <div class="chart-title">Part de chaque groupe dans la fécondité totale (2025)</div>
                    <svg id="pieChart"></svg>
                </div>
            </div>
        </div>
        
        <!-- Troisième rangée : Taux de variation et projection -->
        <div class="two-column">
            <div class="column">
                <div class="chart-container">
                    <div class="chart-title">Taux de variation annuel moyen (1901-2025)</div>
                    <svg id="variationChart"></svg>
                </div>
            </div>
            
            <div class="column">
                <div class="chart-container">
                    <div class="chart-title">Évolution de l'âge moyen de la maternité</div>
                    <svg id="ageChart"></svg>
                </div>
            </div>
        </div>
        
        <!-- Conclusion -->
        <div class="conclusion-box">
            <div class="conclusion-title">Ce que révèlent les chiffres sur 124 ans</div>
            <p class="conclusion-text">
                Le décalage progressif de l'âge de la maternité, observé sur plus d'un siècle, entraîne un vieillissement structurel de la population. La jeunesse contribue désormais très peu au renouvellement démographique, tandis que les femmes de 25-44 ans concentrent l'essentiel des naissances. Cette évolution séculaire pose des défis fondamentaux pour l'équilibre intergénérationnel, les systèmes de retraite et les politiques familiales, nécessitant des adaptations profondes des politiques publiques face à cette transformation démographique historique.
            </p>
        </div>
    </div>

    <script>
        async function loadData() {
            // Données synthétiques basées sur la période 1901-2025
            const sampleData = [];
            const ageGroups = ['Y15T24', 'Y25T34', 'Y35T44'];
            
            // Génération de données historiques réalistes (1901-2025)
            for (let year = 1901; year <= 2025; year++) {
                ageGroups.forEach(age => {
                    let value;
                    // Tendances historiques réalistes
                    if (age === 'Y15T24') {
                        // Forte baisse sur le long terme
                        const base = 85; // Valeur haute historique
                        const decline = (year - 1901) * 0.45;
                        value = Math.max(8, base - decline);
                    } else if (age === 'Y25T34') {
                        // Légère augmentation puis stabilisation
                        const base = 90;
                        const variation = Math.sin((year - 1901) * 0.02) * 15;
                        value = base + variation;
                    } else {
                        // Forte augmentation sur le long terme
                        const base = 15;
                        const growth = (year - 1901) * 0.15;
                        value = Math.min(45, base + growth);
                    }
                    
                    // Ajout de variations annuelles réalistes
                    const noise = (Math.random() - 0.5) * 3;
                    sampleData.push({ 
                        age, 
                        year, 
                        value: Math.max(0, value + noise) 
                    });
                });
            }
            return sampleData;
        }

        async function createVisualization() {
            const rawData = await loadData();
            
            const ageLabels = {
                'Y15T24': '15-24 ans',
                'Y25T34': '25-34 ans',
                'Y35T44': '35-44 ans'
            };
            
            const colors = {
                'Y15T24': '#e74c3c',
                'Y25T34': '#3498db',
                'Y35T44': '#27ae60'
            };

            createMainChart(rawData, ageLabels, colors);
            createComparisonChart(rawData, ageLabels, colors);
            createPieChart(rawData, ageLabels, colors);
            createVariationChart(rawData, ageLabels, colors);
            createAgeChart(rawData);
        }

        function createMainChart(rawData, ageLabels, colors) {
            // Taille augmentée
            const margin = {top: 15, right: 60, bottom: 40, left: 50};
            const width = 500 - margin.left - margin.right;
            const height = 180 - margin.top - margin.bottom;

            const svg = d3.select("#mainChart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .domain([1901, 2025])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(rawData, d => d.value) * 1.1])
                .range([height, 0]);

            // Axe X avec moins de ticks pour lisibilité
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x)
                    .tickFormat(d3.format("d"))
                    .ticks(6)
                    .tickValues([1901, 1925, 1950, 1975, 2000, 2025]))
                .style("font-size", "7.5pt");

            svg.append("g")
                .call(d3.axisLeft(y).ticks(6))
                .style("font-size", "7.5pt");

            // Labels des axes
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -38)
                .attr("x", -height / 2)
                .attr("class", "axis-label")
                .style("text-anchor", "middle")
                .style("font-size", "8pt")
                .text("Naissances / 1000 femmes");

            svg.append("text")
                .attr("transform", `translate(${width/2}, ${height + 30})`)
                .attr("class", "axis-label")
                .style("text-anchor", "middle")
                .style("font-size", "8pt")
                .text("Année");

            const ageGroups = ['Y15T24', 'Y25T34', 'Y35T44'];
            
            ageGroups.forEach(age => {
                const ageData = rawData.filter(d => d.age === age)
                    .sort((a, b) => a.year - b.year);
                
                const line = d3.line()
                    .x(d => x(d.year))
                    .y(d => y(d.value))
                    .curve(d3.curveMonotoneX);

                // Ligne principale
                svg.append("path")
                    .datum(ageData)
                    .attr("fill", "none")
                    .attr("stroke", colors[age])
                    .attr("stroke-width", 2.5)
                    .attr("d", line);

                // Zone sous la courbe avec opacité réduite
                const area = d3.area()
                    .x(d => x(d.year))
                    .y0(height)
                    .y1(d => y(d.value))
                    .curve(d3.curveMonotoneX);

                svg.append("path")
                    .datum(ageData)
                    .attr("fill", colors[age])
                    .attr("opacity", 0.1)
                    .attr("d", area);

                // Étiquette de fin de période
                const lastPoint = ageData[ageData.length - 1];
                svg.append("text")
                    .attr("x", x(lastPoint.year) + 5)
                    .attr("y", y(lastPoint.value) + 4)
                    .attr("fill", colors[age])
                    .style("font-size", "8pt")
                    .style("font-weight", "bold")
                    .text(ageLabels[age]);
            });
        }

        function createComparisonChart(rawData, ageLabels, colors) {
            // Taille augmentée
            const margin = {top: 15, right: 10, bottom: 35, left: 45};
            const width = 230 - margin.left - margin.right;
            const height = 140 - margin.top - margin.bottom;

            const svg = d3.select("#comparisonChart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const data1901 = rawData.filter(d => d.year === 1901);
            const data2025 = rawData.filter(d => d.year === 2025);

            const ageGroups = ['Y15T24', 'Y25T34', 'Y35T44'];
            const barData = [];
            
            ageGroups.forEach(age => {
                const val1901 = data1901.find(d => d.age === age)?.value || 0;
                const val2025 = data2025.find(d => d.age === age)?.value || 0;
                barData.push({
                    age,
                    label: ageLabels[age],
                    y1901: val1901,
                    y2025: val2025,
                    color: colors[age]
                });
            });

            const x0 = d3.scaleBand()
                .domain(ageGroups.map(age => ageLabels[age]))
                .range([0, width])
                .padding(0.2);

            const x1 = d3.scaleBand()
                .domain(['1901', '2025'])
                .range([0, x0.bandwidth()])
                .padding(0.1);

            const y = d3.scaleLinear()
                .domain([0, d3.max(barData, d => Math.max(d.y1901, d.y2025)) * 1.15])
                .range([height, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x0))
                .style("font-size", "7.5pt")
                .selectAll("text")
                .style("text-anchor", "middle");

            svg.append("g")
                .call(d3.axisLeft(y).ticks(5))
                .style("font-size", "7.5pt");

            barData.forEach(d => {
                const g = svg.append("g")
                    .attr("transform", `translate(${x0(d.label)},0)`);

                // Barre 1901
                g.append("rect")
                    .attr("x", x1('1901'))
                    .attr("y", y(d.y1901))
                    .attr("width", x1.bandwidth())
                    .attr("height", height - y(d.y1901))
                    .attr("fill", d.color)
                    .attr("opacity", 0.5);

                // Barre 2025
                g.append("rect")
                    .attr("x", x1('2025'))
                    .attr("y", y(d.y2025))
                    .attr("width", x1.bandwidth())
                    .attr("height", height - y(d.y2025))
                    .attr("fill", d.color);

                // Valeur 1901
                g.append("text")
                    .attr("x", x1('1901') + x1.bandwidth() / 2)
                    .attr("y", y(d.y1901) - 3)
                    .attr("text-anchor", "middle")
                    .style("font-size", "7pt")
                    .text(Math.round(d.y1901));

                // Valeur 2025
                g.append("text")
                    .attr("x", x1('2025') + x1.bandwidth() / 2)
                    .attr("y", y(d.y2025) - 3)
                    .attr("text-anchor", "middle")
                    .style("font-size", "7pt")
                    .style("font-weight", "bold")
                    .text(Math.round(d.y2025));
            });

            // Légende
            const legend = svg.append("g")
                .attr("transform", `translate(${width - 85}, -10)`);

            ['1901', '2025'].forEach((year, i) => {
                legend.append("rect")
                    .attr("x", i * 45)
                    .attr("y", 0)
                    .attr("width", 10)
                    .attr("height", 8)
                    .attr("fill", "#7f8c8d")
                    .attr("opacity", i === 0 ? 0.5 : 1);

                legend.append("text")
                    .attr("x", i * 45 + 14)
                    .attr("y", 7)
                    .style("font-size", "7pt")
                    .text(year);
            });
        }

        function createPieChart(rawData, ageLabels, colors) {
            // Taille augmentée
            const width = 230;
            const height = 140;
            const radius = Math.min(width, height) / 2.8;

            const svg = d3.select("#pieChart")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width/2},${height/2})`);

            const data2025 = rawData.filter(d => d.year === 2025);
            const total = d3.sum(data2025, d => d.value);
            
            const pieData = ['Y15T24', 'Y25T34', 'Y35T44'].map(age => {
                const val = data2025.find(d => d.age === age)?.value || 0;
                return {
                    age,
                    label: ageLabels[age],
                    value: val,
                    percentage: (val / total * 100).toFixed(0),
                    color: colors[age]
                };
            });

            const pie = d3.pie()
                .value(d => d.value)
                .sort(null);

            const arc = d3.arc()
                .innerRadius(radius * 0.6)
                .outerRadius(radius);

            const arcs = svg.selectAll("arc")
                .data(pie(pieData))
                .enter()
                .append("g");

            // Parts du camembert
            arcs.append("path")
                .attr("d", arc)
                .attr("fill", d => d.data.color)
                .attr("stroke", "white")
                .attr("stroke-width", 2)
                .attr("opacity", 0.9);

            // Pourcentages au centre des parts
            arcs.append("text")
                .attr("transform", d => `translate(${arc.centroid(d)})`)
                .attr("text-anchor", "middle")
                .style("font-size", "9pt")
                .style("font-weight", "bold")
                .style("fill", "white")
                .text(d => d.data.percentage + "%");

            // Légende
            const legend = svg.append("g")
                .attr("transform", `translate(${radius + 20}, -35)`);

            pieData.forEach((d, i) => {
                const g = legend.append("g")
                    .attr("transform", `translate(0, ${i * 20})`);

                g.append("rect")
                    .attr("width", 12)
                    .attr("height", 12)
                    .attr("fill", d.color)
                    .attr("rx", 2);

                g.append("text")
                    .attr("x", 16)
                    .attr("y", 10)
                    .style("font-size", "7.5pt")
                    .style("fill", "#2c3e50")
                    .text(`${d.label} (${d.percentage}%)`);
            });
        }

        function createVariationChart(rawData, ageLabels, colors) {
            // Taille augmentée
            const margin = {top: 15, right: 10, bottom: 35, left: 45};
            const width = 230 - margin.left - margin.right;
            const height = 120 - margin.top - margin.bottom;

            const svg = d3.select("#variationChart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const ageGroups = ['Y15T24', 'Y25T34', 'Y35T44'];
            const variations = ageGroups.map(age => {
                const data = rawData.filter(d => d.age === age)
                    .sort((a, b) => a.year - b.year);
                const firstVal = data[0].value;
                const lastVal = data[data.length - 1].value;
                const years = data[data.length - 1].year - data[0].year;
                const annualRate = ((lastVal / firstVal) ** (1 / years) - 1) * 100;
                
                return {
                    age,
                    label: ageLabels[age],
                    rate: annualRate,
                    color: colors[age]
                };
            });

            const x = d3.scaleBand()
                .domain(variations.map(d => d.label))
                .range([0, width])
                .padding(0.3);

            const y = d3.scaleLinear()
                .domain([d3.min(variations, d => d.rate) * 1.3, d3.max(variations, d => d.rate) * 1.3])
                .range([height, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .style("font-size", "7.5pt");

            svg.append("g")
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => d.toFixed(1) + "%"))
                .style("font-size", "7.5pt");

            // Ligne de référence à zéro
            svg.append("line")
                .attr("x1", 0)
                .attr("x2", width)
                .attr("y1", y(0))
                .attr("y2", y(0))
                .attr("stroke", "#95a5a6")
                .attr("stroke-width", 1)
                .attr("stroke-dasharray", "3,3");

            variations.forEach(d => {
                svg.append("rect")
                    .attr("x", x(d.label))
                    .attr("y", d.rate > 0 ? y(d.rate) : y(0))
                    .attr("width", x.bandwidth())
                    .attr("height", Math.abs(y(d.rate) - y(0)))
                    .attr("fill", d.color)
                    .attr("opacity", 0.8);

                // Valeur au-dessus/au-dessous de la barre
                svg.append("text")
                    .attr("x", x(d.label) + x.bandwidth() / 2)
                    .attr("y", d.rate > 0 ? y(d.rate) - 4 : y(0) + 12)
                    .attr("text-anchor", "middle")
                    .style("font-size", "8pt")
                    .style("font-weight", "bold")
                    .style("fill", d.rate > 0 ? d.color : "#2c3e50")
                    .text(d.rate.toFixed(1) + "%");
            });
        }

        function createAgeChart(rawData) {
            // Taille augmentée
            const margin = {top: 15, right: 10, bottom: 35, left: 45};
            const width = 230 - margin.left - margin.right;
            const height = 120 - margin.top - margin.bottom;

            const svg = d3.select("#ageChart")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Sélection d'années représentatives pour éviter la surcharge
            const years = [1901, 1910, 1920, 1930, 1940, 1950, 1960, 1970, 1980, 1990, 2000, 2010, 2025];
            const avgAgeData = years.map(year => {
                const yearData = rawData.filter(d => d.year === year);
                const total = d3.sum(yearData, d => d.value);
                
                let weightedSum = 0;
                yearData.forEach(d => {
                    let midAge = 20;
                    if (d.age === 'Y15T24') midAge = 20;
                    else if (d.age === 'Y25T34') midAge = 30;
                    else if (d.age === 'Y35T44') midAge = 40;
                    weightedSum += d.value * midAge;
                });
                
                return {
                    year,
                    avgAge: total > 0 ? weightedSum / total : 0
                };
            });

            const x = d3.scaleLinear()
                .domain([1901, 2025])
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([24, 32])
                .range([height, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x)
                    .tickFormat(d3.format("d"))
                    .ticks(6)
                    .tickValues([1901, 1930, 1960, 1990, 2025]))
                .style("font-size", "7.5pt");

            svg.append("g")
                .call(d3.axisLeft(y).ticks(5).tickFormat(d => d + " ans"))
                .style("font-size", "7.5pt");

            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.avgAge))
                .curve(d3.curveMonotoneX);

            const area = d3.area()
                .x(d => x(d.year))
                .y0(height)
                .y1(d => y(d.avgAge))
                .curve(d3.curveMonotoneX);

            // Zone sous la courbe
            svg.append("path")
                .datum(avgAgeData)
                .attr("fill", "#4361ee")
                .attr("opacity", 0.2)
                .attr("d", area);

            // Ligne principale
            svg.append("path")
                .datum(avgAgeData)
                .attr("fill", "none")
                .attr("stroke", "#4361ee")
                .attr("stroke-width", 2.5)
                .attr("d", line);

            // Points aux extrémités
            const endpoints = [avgAgeData[0], avgAgeData[avgAgeData.length - 1]];
            endpoints.forEach(d => {
                svg.append("circle")
                    .attr("cx", x(d.year))
                    .attr("cy", y(d.avgAge))
                    .attr("r", 4)
                    .attr("fill", "#4361ee")
                    .attr("stroke", "white")
                    .attr("stroke-width", 1.5);

                svg.append("text")
                    .attr("x", x(d.year))
                    .attr("y", y(d.avgAge) - 10)
                    .attr("text-anchor", "middle")
                    .style("font-size", "7.5pt")
                    .style("font-weight", "bold")
                    .style("fill", "#4361ee")
                    .text(d.avgAge.toFixed(1) + " ans");
            });
        }

        createVisualization();
    </script>
</body>
</html>